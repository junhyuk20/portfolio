<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="my.web.note.dao.BoardMapper">
	<insert id="boardInsert" parameterType="board">
		insert into
			b_table(
				board_no
				,member_id
				,board_title
				,board_context
				<if test="originalfile != null">
					,originalfile
					,savedfile
				</if>
			)values(
				b_table_seq.nextval
				,#{member_id}
				,#{board_title}
				,#{board_context}
				<if test="originalfile != null">
					,#{originalfile}
					,#{savedfile}
				</if>
			)
	</insert>
	
	<select id="boardList" parameterType="hashmap" resultType="hashmap">
		select
			b.board_no 		as board_no
			,b.member_id	as member_id
			,b.board_title	as board_title
			,b.board_context as board_context
			,to_char(b.board_indate, 'YYYY-MM-DD') as board_indate
			,b.board_hits	as board_hits
			,m.member_nm	as member_nm
		from
			b_table b, m_table m
		where
			b.member_id = m.member_id
		<if test="searchType != '' ">
			<if test="searchType == 'title' ">
				and
					b.board_title like '%'||#{searchText}||'%'
			</if>
			<if test="searchType == 'name' ">
				and
					m.member_nm like '%'||#{searchText}||'%'
			</if>
		</if>
		
		order by
			board_no desc
	</select>
	
	<select id="selectAll" resultType="hashmap">
		select
			b.board_no 		as board_no
			,b.member_id	as board_id
			,b.board_title	as board_title
			,b.board_context as board_context
			,to_char(b.board_indate, 'YYYY-MM-DD') as board_indate
			,b.board_hits	as board_hits
			,m.member_nm	as member_nm
		from
			b_table b, m_table m
		where
			b.member_id = m.member_id
	</select>
	
	<select id="boardRead" parameterType="int" resultType="hashmap">
		select
				b.board_no 		as board_no
				,b.member_id	as member_id
				,b.board_title	as board_title
				,b.board_context as board_context
				,to_char(b.board_indate, 'YYYY-MM-DD') as board_indate
				,b.board_hits	as board_hits
				,m.member_nm	as member_nm
				,b.originalfile as originalfile
				,b.savedfile 	as savedfile
			from
				b_table b, m_table m
			where
				b.member_id = m.member_id
			and
				b.board_no = #{board_no}
	</select>
	
	
	
	<update id="updateHits" parameterType="int">
		update
			b_table
		set
			board_hits = board_hits+1
		where
			board_no = #{board_no}
	</update>
	
	<delete id="boardDelete" parameterType="board">
		delete from
			b_table
		where
			board_no = #{board_no}
		and
			member_id = #{member_id}
	</delete>
	
	<select id="selectOne" parameterType="board" resultType="hashmap">
		select
				b.board_no 		as board_no
				,b.member_id	as member_id
				,b.board_title	as board_title
				,b.board_context as board_context
				,to_char(b.board_indate, 'YYYY-MM-DD') as board_indate
				,b.board_hits	as board_hits
				,m.member_nm	as member_nm
				,b.originalfile as originalfile
				,b.savedfile 	as savedfile
			from
				b_table b, m_table m
			where
				b.member_id = m.member_id
			and
				b.board_no = #{board_no}
	</select>
	
	<update id="boardUpdate" parameterType="board">
		update
			b_table
		set
			board_title = #{board_title}
			,board_context = #{board_context}
		where
			board_no = #{board_no}
		and
			member_id = #{member_id}
	</update>
	
	<select id="boardOne" parameterType="int" resultType="board">
		select
			board_no
			,member_id
			,board_title
			,board_context
			,board_indate
			,board_hits
			,originalfile
			,savedfile
		from
			b_table
		where
			board_no =#{board_no}
	</select>
	
	<select id="boardCount" parameterType="hashmap" resultType="int">
		select
			count(*)
		from
			b_table b, m_table m
		where
			b.member_id = m.member_id
		<if test="searchType != '' ">
			<if test="searchType == 'title' ">
				and
					b.board_title like '%'||#{searchText}||'%'
			</if>
			<if test="searchType == 'name' ">
				and
					m.member_nm like '%'||#{searchText}||'%'
			</if>
		</if>
		order by
			board_no desc
	</select>
	

	
	
	
	
	
</mapper>
